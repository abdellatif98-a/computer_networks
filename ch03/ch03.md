# ch03
---
## Multiplexing and Demultiplexing
- Connectionless Demultiplexing
  - UDP socket identified by 2-tuple
    - Dest IP Address
    - Dest Port
  - _e.g._ `DatagramSocket serverSocket = new DatagramSocket(6428)`
- Connection-Oriented Demultiplexing
  - TCP socket identified by 4-tuple (i.e. _connection pairs are unique_)
    - Source IP Address
    - Source Port
    - Dest IP Address
    - Dest Port
## UDP
- Key Features:
  - No Connection Establishment
    - No Delay
  - No Connection State at Sender, Receiver
    - Simple & Cheap
  - Small Segment Header
    - Less Wasted Bandwidth
  - No Congestion Control
    - No Speed Limits
- why checksum at Transport level?
  - No guarantees that your link layer is reliable and is doing the checksum
  - End-to-End principle
    - _e.g._ TCP checksum vs. Application checksum
    - _e.g._ "smart" TCP vs. "dumb" IP
## Principles of Reliable Data Transfer
- How to build up a reliable channel on a unreliable channel?
  - ![build reliable](https://github.com/chopchap/computer-networking/blob/main/images/build%20reliable.png?raw=true)
- Pipelining Protocals
  - Go-Back-N
    - Sender
      - Up to N unACKed pkts in pipeline
    - Receiver
      - Only sends _cumulative_ ACKs
      - Doesn't ACK pkt if there's a gap
    - Sender
      - Timeer for oldest unACKed pkt
      - If timer expires, retransmit _all_ unACKed pkts
    - ![GBN](https://github.com/chopchap/computer-networking/blob/main/images/GBN.png?raw=true)
  - Selective Repeat
    - Sender
      - Up to N unACKed pkts in pipeline
    - Receiver
      - ACKs individual pkts
    - Sender
      - Timer for _each_ unACKed pkt
      - If timer expires, retransmit _only_ unACKed pkt
    - ![SR](https://github.com/chopchap/computer-networking/blob/main/images/selective%20repeat.png?raw=true)
  - TCP use _selective acknowledgement_, which is a hybrid of **GBN** and **SR** protocals
## TCP
- Key Features:
  - Unicast (one-to-one communication)
  - Reliable, In-Order Byte Stream
  - Connection-Oriented
  - Pipelined
- TCP Round Trip Time and Timeout
  - EstimatedRTT = (1 - α) * EstimatedRTT + α * SampleRTT
  - TimeOut = EstimatedRTT + "safety margin"
  - Safety Margin = Estimated Deviation of SampleRTT
  - DevRTT = (1 - β) * DevRTT + β * |SampleRTT - EstimatedRTT|
  - TimeoutInterval = EstimatedRTT + 4 * DevRTT
- TCP Reliable Data Transfer
  - Pipelined Segments
  - Cumulative ACKs
  - Single Retransmission Timer
  - Retransmissions Triggered by:
    - Timeouts
    - Duplicate ACKs
  - Fast Retransmit
    - If 3 ACKs received assume the worst
    - Resend segment **before** timer expires
- TCP Flow Control
  - ![tcp flow control](https://github.com/chopchap/computer-networking/blob/main/images/TCP%20flow%20control.png?raw=true)
  - **SYN flood attack** solved by **SYN cookies**
- 3-Way Handshake
  - Client sends TCP SYN to server
    - Specifies Initial Seq #
    - No Data
  - Server receives SYN, replies with SYNACK
    - Server Allocates Buffers
    - Specifies Server Initial Seq #
    - No Data
  - Client receives SYNACK, replies with ACK
    - May Contain Data
- 4-steps Closing a TCP Connection
  - FIN sent
  - ACK sent
    - Receive FIN
    - Closes connection
    - Send FIN
  - ACK Received
    - Receive FIN
    - Replies with ACK
  - ACK Received
    - Connection Closed
- TCP Segment Structure
  - ![tcp seg structure](https://github.com/chopchap/computer-networking/blob/main/images/TCP%20segment%20structure.png?raw=true)
- TCP Congestion Control
  - ![tcp congestion control](https://github.com/chopchap/computer-networking/blob/main/images/TCP%20congestion%20control.png?raw=true)
  - How to perceive congestion?
    - Implicit End-to-End Feedback
    - ACK Received implies no congestion, it can speed up sending rate
    - ACK Not Received implies congestion
  - How to limit send rate?
    - Limiting # of unACKed bytes "in pipeline"
      - cwnd: differs from rwnd
      - Sender limited by min(cwnd, rwnd)
  - How to change send rate?
    - rate = cwnd/RTT
    - Specifically:
      - Success Event (If ACK Received, increase cwnd in one of the two following ways):
        - Slow start
          - Increase Exponentially
          - Connection Start or After Timeout
        - Congestion Avoidance
          - Increase Linearly
          - Normal Operation
      - Loss Event (If Segment Lost, decrease cwnd in one of the two following ways):
        - Timeout
          - Cut cwnd to 1 MSS
          - ssthresh set to cwnd/2
        - Triple Duplicate ACKs
          - ssthresh set to cwnd/2
          - cwnd set to ~ ssthresh
    - ![AIMD, additive increase multiplicative decrease](https://github.com/chopchap/computer-networking/blob/main/images/threshold%20and%20cwnd.png?raw=true)
